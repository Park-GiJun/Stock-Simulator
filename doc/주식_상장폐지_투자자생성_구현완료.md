# ì£¼ì‹ ìƒì¥/ìƒì¥íì§€ ë° íˆ¬ìì ìƒì„± ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

## âœ… êµ¬í˜„ ì™„ë£Œ ì‚¬í•­

### 1. ì‹œì¦Œ ì‹œìŠ¤í…œ ì œê±°
- âŒ `backend/season-service` ì‚­ì œ (ë¹Œë“œì—ì„œ ì œì™¸)
- âŒ `SeasonStartedEvent`, `SeasonEndedEvent` ì œê±°
- âŒ `SeasonStatus` enum ì œê±°
- âŒ Kafka topics `season.started`, `season.ended` ì œê±°
- âŒ Docker Composeì—ì„œ season-service ì œê±°
- âŒ Prometheusì—ì„œ season-service ëª¨ë‹ˆí„°ë§ ì œê±°
- âŒ PostgreSQL schema `season` ì œê±°

### 2. ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ì¶”ê°€ (Common ëª¨ë“ˆ)

**íŒŒì¼: `backend/common/src/main/kotlin/com/stocksimulator/common/event/DomainEvent.kt`**

ì¶”ê°€ëœ Kafka Topics:
```kotlin
const val STOCK_LISTED = "stock.listed"
const val STOCK_DELISTED = "stock.delisted"
const val INVESTOR_CREATED = "investor.created"
```

ì¶”ê°€ëœ ì´ë²¤íŠ¸ í´ë˜ìŠ¤:
```kotlin
// ì£¼ì‹ ìƒì¥ ì´ë²¤íŠ¸
data class StockListedEvent(
    val stockId: String,
    val stockName: String,
    val sector: String,
    val basePrice: Long,
    val totalShares: Long,
    val marketCapGrade: String,
    val listedAt: Instant = Instant.now()
)

// ì£¼ì‹ ìƒì¥íì§€ ì´ë²¤íŠ¸
data class StockDelistedEvent(
    val stockId: String,
    val stockName: String,
    val reason: String,
    val finalPrice: Long,
    val delistedAt: Instant = Instant.now()
)

// íˆ¬ìì ìƒì„± ì´ë²¤íŠ¸
data class InvestorCreatedEvent(
    val investorId: String,
    val investorType: String,  // INDIVIDUAL, INSTITUTION
    val investmentStyle: String,
    val initialCapital: Long,
    val parameters: Map<String, Any>,
    val createdAt: Instant = Instant.now()
)
```

### 3. ìƒˆë¡œìš´ Enum ì¶”ê°€

**íŒŒì¼: `backend/common/src/main/kotlin/com/stocksimulator/common/dto/Enums.kt`**

```kotlin
// ì£¼ì‹ ìƒíƒœ
enum class StockStatus {
    LISTED,      // ìƒì¥
    SUSPENDED,   // ê±°ë˜ì •ì§€
    DELISTED     // ìƒì¥íì§€
}

// íˆ¬ìì ìœ í˜•
enum class InvestorType {
    INDIVIDUAL,  // ê°œì¸
    INSTITUTION  // ê¸°ê´€
}
```

### 4. Scheduler Service êµ¬í˜„

#### 4.1 Kafka Producer ì„¤ì •
**íŒŒì¼: `backend/scheduler-service/src/main/kotlin/com/stocksimulator/schedulerservice/config/KafkaProducerConfig.kt`**
- JSON serializerë¡œ ì´ë²¤íŠ¸ ë°œí–‰

#### 4.2 ê¸°ì—…ëª… ìƒì„±ê¸°
**íŒŒì¼: `backend/scheduler-service/src/main/kotlin/com/stocksimulator/schedulerservice/service/CompanyNameGenerator.kt`**
- ì‚°ì—…ë³„ í‚¤ì›Œë“œ ì¡°í•©ìœ¼ë¡œ ëœë¤ ê¸°ì—…ëª… ìƒì„±
- ì¢…ëª© ì½”ë“œ ìƒì„± (A100000 ~ A999999)

#### 4.3 ì£¼ì‹ ìƒì¥/ìƒì¥íì§€ ìŠ¤ì¼€ì¤„ëŸ¬
**íŒŒì¼: `backend/scheduler-service/src/main/kotlin/com/stocksimulator/schedulerservice/scheduler/StockListingScheduler.kt`**

**IPO (ì‹ ê·œ ìƒì¥):**
```kotlin
@Scheduled(fixedRate = 1800000) // 30ë¶„ë§ˆë‹¤
fun checkForIPO() {
    if (Random.nextDouble() < 0.3) { // 30% í™•ë¥ 
        initiateIPO()
    }
}
```
- ëœë¤ ì‚°ì—…, ì‹œì´ ë“±ê¸‰, ê¸°ì¤€ê°€ ìƒì„±
- ë°œí–‰ì£¼ì‹ìˆ˜ ìë™ ê³„ì‚°
- Kafkaë¡œ `StockListedEvent` ë°œí–‰

**ìƒì¥íì§€:**
```kotlin
@Scheduled(fixedRate = 3600000) // 1ì‹œê°„ë§ˆë‹¤
fun checkForDelisting() {
    if (Random.nextDouble() < 0.1) { // 10% í™•ë¥ 
        initiateDelisting()
    }
}
```
- ì¡°ê±´: ì‹œì´ 50ì–µ ë¯¸ë§Œ, ê±°ë˜ëŸ‰ ì €ì¡°, ì£¼ê°€ ì•¡ë©´ê°€ ì´í•˜ ë“±
- Kafkaë¡œ `StockDelistedEvent` ë°œí–‰

#### 4.4 íˆ¬ìì ìƒì„± ìŠ¤ì¼€ì¤„ëŸ¬
**íŒŒì¼: `backend/scheduler-service/src/main/kotlin/com/stocksimulator/schedulerservice/scheduler/InvestorGenerationScheduler.kt`**

**ê°œì¸ íˆ¬ìì ìƒì„±:**
```kotlin
@Scheduled(fixedRate = 600000) // 10ë¶„ë§ˆë‹¤
fun generateIndividualInvestors() {
    val count = Random.nextInt(1, 4) // 1~3ëª…
    repeat(count) {
        // ê°œì¸ íˆ¬ìì ìƒì„± ë¡œì§
    }
}
```
- ìë³¸ê¸ˆ: 20ë§Œ ~ 1ì–µì›
- ì£¼ê¸‰: ìë³¸ê¸ˆì˜ 5%
- íˆ¬ì ì„±í–¥: AGGRESSIVE, STABLE, VALUE, RANDOM
- íŒŒë¼ë¯¸í„°: ìœ„í—˜í—ˆìš©ë„, ì„ í˜¸/ê¸°í”¼ ì‚°ì—…, FOMO, ê³µí¬ë§¤ë„ ì„±í–¥ ë“±

**ê¸°ê´€ íˆ¬ìì ìƒì„±:**
```kotlin
@Scheduled(fixedRate = 7200000) // 2ì‹œê°„ë§ˆë‹¤
fun generateInstitutionalInvestor() {
    if (Random.nextDouble() < 0.5) { // 50% í™•ë¥ 
        // ê¸°ê´€ íˆ¬ìì ìƒì„± ë¡œì§
    }
}
```
- ìë³¸ê¸ˆ: 10ì–µ ~ 1ì¡°ì›
- ì¼ê¸‰: ìë³¸ê¸ˆì˜ 1%
- íˆ¬ì ì„±í–¥: AGGRESSIVE, STABLE, VALUE (RANDOM ì œì™¸)
- íŒŒë¼ë¯¸í„°: ìœ„í—˜í—ˆìš©ë„, ì¢…ëª©ë‹¹ ìµœëŒ€ ë¹„ì¤‘, ë¦¬ë°¸ëŸ°ì‹± ì£¼ê¸° ë“±

### 5. CLAUDE.md ì—…ë°ì´íŠ¸

ì¶”ê°€ëœ ë‚´ìš©:
- ì´ë²¤íŠ¸ ê¸°ë°˜ ì£¼ì‹ ìƒì¥/ìƒì¥íì§€ ì„¤ëª…
- ë™ì  íˆ¬ìì ìƒì„± ë©”ì»¤ë‹ˆì¦˜
- Kafka ì´ë²¤íŠ¸ í† í”½ ëª©ë¡
- ê²Œì„ ë©”ì»¤ë‹ˆì¦˜ (ì‹œê°„ ì‹œìŠ¤í…œ, ì£¼ì‹ ì‹œì¥, íˆ¬ìì)
- ì‹œì¦Œ ì‹œìŠ¤í…œ ì œê±° ëª…ì‹œ

---

## ğŸ“Š ì‹œìŠ¤í…œ ë™ì‘ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Scheduler Service (ë§¤ 30ë¶„/1ì‹œê°„/2ì‹œê°„)         â”‚
â”‚                                                          â”‚
â”‚  - StockListingScheduler                                â”‚
â”‚    âœ“ IPO: 30% í™•ë¥ ë¡œ ì‹ ê·œ ê¸°ì—… ìƒì¥                      â”‚
â”‚    âœ“ Delisting: 10% í™•ë¥ ë¡œ ê¸°ì—… ìƒì¥íì§€                â”‚
â”‚                                                          â”‚
â”‚  - InvestorGenerationScheduler                          â”‚
â”‚    âœ“ ê°œì¸: 10ë¶„ë§ˆë‹¤ 1~3ëª… ìƒì„±                          â”‚
â”‚    âœ“ ê¸°ê´€: 2ì‹œê°„ë§ˆë‹¤ 50% í™•ë¥ ë¡œ 1ê°œ ìƒì„±                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ Kafka Events
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Stock Service   â”‚            â”‚ Trading Service  â”‚
â”‚                  â”‚            â”‚                  â”‚
â”‚ âœ“ stock.listed   â”‚            â”‚ âœ“ investor.      â”‚
â”‚   â†’ ì£¼ì‹ ìƒì„±    â”‚            â”‚   created        â”‚
â”‚                  â”‚            â”‚   â†’ NPC/ê¸°ê´€ ìƒì„±â”‚
â”‚ âœ“ stock.delisted â”‚            â”‚   â†’ ì´ˆê¸° ìë³¸ ë°°ë¶„â”‚
â”‚   â†’ ìƒíƒœ ë³€ê²½    â”‚            â”‚   â†’ ìë™ ë§¤ë§¤ ì‹œì‘â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„ (TODO)

### Stock Service êµ¬í˜„ í•„ìš”
1. `StockEventConsumer` - Kafka ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
   - `stock.listed` ì²˜ë¦¬ â†’ DBì— ì£¼ì‹ ì €ì¥
   - `stock.delisted` ì²˜ë¦¬ â†’ ì£¼ì‹ ìƒíƒœ DELISTEDë¡œ ë³€ê²½

2. `Stock` Entity ë° Repository
   - JPA Entity ì •ì˜
   - PostgreSQL `stocks` ìŠ¤í‚¤ë§ˆì— ì €ì¥

### Trading Service êµ¬í˜„ í•„ìš”
1. `InvestorEventConsumer` - Kafka ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
   - `investor.created` ì²˜ë¦¬ â†’ NPC/ê¸°ê´€ ìƒì„±

2. `Investor` Entity ë° Repository
   - ê°œì¸/ê¸°ê´€ íˆ¬ìì ì •ë³´ ì €ì¥
   - ì •ê¸° ìˆ˜ì… ì§€ê¸‰ ìŠ¤ì¼€ì¤„ë§

3. NPC ìë™ ë§¤ë§¤ ë¡œì§
   - íˆ¬ì ì„±í–¥ë³„ ë§¤ë§¤ ì „ëµ
   - FOMO, ê³µí¬ë§¤ë„ êµ¬í˜„

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. Docker í™˜ê²½ì—ì„œ ì‹¤í–‰
```bash
# ì „ì²´ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose --profile all down
docker-compose --profile all up -d --build

# Scheduler Service ë¡œê·¸ í™•ì¸
docker logs stockSimulator-scheduler-service -f
```

### 2. ì´ë²¤íŠ¸ í™•ì¸
- **Kafka UI**: http://localhost:8089
  - Topics íƒ­ì—ì„œ `stock.listed`, `stock.delisted`, `investor.created` í™•ì¸
  
- **Prometheus**: http://localhost:9091/targets
  - Scheduler Service ìƒíƒœ í™•ì¸

- **Grafana**: http://localhost:3001
  - Scheduler Service ë©”íŠ¸ë¦­ í™•ì¸

---

## ğŸ“ ë¡œê·¸ ì˜ˆì‹œ

### IPO ë°œìƒ ì‹œ
```
ğŸ“ˆ IPO ë°œìƒ!
- ì¢…ëª©: ë„¤ì˜¤AI (A123456)
- ì‚°ì—…: IT
- ê¸°ì¤€ê°€: 25,000ì›
- ì‹œì´ ë“±ê¸‰: ì¤‘í˜•ì£¼
- ë°œí–‰ì£¼ì‹ìˆ˜: 4,000,000ì£¼
```

### ìƒì¥íì§€ ì‹œ
```
ğŸ“‰ ìƒì¥íì§€ ë°œìƒ!
- ì¢…ëª©: ìƒì¥íì§€ì˜ˆì • ê¸°ì—… (A789012)
- ì‚¬ìœ : ì‹œê°€ì´ì•¡ 50ì–µ ë¯¸ë§Œ ì§€ì†
- ìµœì¢…ê°€: 2,500ì›
```

### ê°œì¸ íˆ¬ìì ìƒì„± ì‹œ
```
ğŸ‘¤ ê°œì¸ íˆ¬ìì ìƒì„±
- ID: NPCe7b3c4d1-2a3b-4c5d-6e7f-8g9h0i1j2k3l
- íˆ¬ì ì„±í–¥: ê³µê²©í˜•
- ì´ˆê¸° ìë³¸ê¸ˆ: 15,000,000ì›
```

### ê¸°ê´€ íˆ¬ìì ìƒì„± ì‹œ
```
ğŸ¢ ê¸°ê´€ íˆ¬ìì ìƒì„±
- ID: INSTa1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p
- íˆ¬ì ì„±í–¥: ê°€ì¹˜íˆ¬ìí˜•
- ì´ˆê¸° ìë³¸ê¸ˆ: 50,000,000,000ì›
```

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] Season Service ì œê±°
- [x] Season ê´€ë ¨ ì´ë²¤íŠ¸ ì œê±°
- [x] Stock Listing/Delisting ì´ë²¤íŠ¸ ì¶”ê°€
- [x] Investor Created ì´ë²¤íŠ¸ ì¶”ê°€
- [x] StockStatus, InvestorType enum ì¶”ê°€
- [x] KafkaProducerConfig êµ¬í˜„
- [x] CompanyNameGenerator êµ¬í˜„
- [x] StockListingScheduler êµ¬í˜„
- [x] InvestorGenerationScheduler êµ¬í˜„
- [x] CLAUDE.md ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] Stock Service ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„ (ë‹¤ìŒ ë‹¨ê³„)
- [ ] Trading Service ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„ (ë‹¤ìŒ ë‹¨ê³„)
