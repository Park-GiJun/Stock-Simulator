# Stock-Simulator ì¸í”„ë¼ êµ¬ì¶• ì§„í–‰ìƒí™©

**ì‘ì„±ì¼:** 2025-01-24
**ì„œë²„:** 172.30.1.79 (homeserver)
**ë„ë©”ì¸:** gijun.net

---

## ğŸ“‹ ëª©ì°¨
1. [ì™„ë£Œëœ ì‘ì—…](#ì™„ë£Œëœ-ì‘ì—…)
2. [í˜„ì¬ ìƒíƒœ](#í˜„ì¬-ìƒíƒœ)
3. [ëª…ë ¹ì–´ ëª¨ìŒ](#ëª…ë ¹ì–´-ëª¨ìŒ)
4. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…-ê¸°ë¡)

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. Docker Compose ì¸í”„ë¼ êµ¬ì¶•

```bash
# ì¸í”„ë¼ ì‹œì‘
docker-compose --profile infra up -d

# ëª¨ë‹ˆí„°ë§ ì‹œì‘
docker-compose --profile monitoring up -d
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë°°í¬

| ì„œë¹„ìŠ¤ | ì»¨í…Œì´ë„ˆ | í¬íŠ¸ | ìƒíƒœ |
|--------|---------|------|------|
| PostgreSQL Primary | stockSimulator-postgres | 5432 | âœ… Running |
| PostgreSQL Replica | stockSimulator-postgres-replica | 5433 | âœ… Running |
| MongoDB | stockSimulator-mongo | 27018 | âœ… Running |
| Redis | stockSimulator-redis | 6380 | âœ… Running |

### 3. ë©”ì‹œì§€ ë¸Œë¡œì»¤ & ì¸í”„ë¼

| ì„œë¹„ìŠ¤ | ì»¨í…Œì´ë„ˆ | í¬íŠ¸ | ìƒíƒœ |
|--------|---------|------|------|
| Zookeeper | stockSimulator-zookeeper | 2181 | âœ… Running |
| Kafka | stockSimulator-kafka | 9093 | âœ… Running |
| Kafka UI | stockSimulator-kafka-ui | 8089 | âœ… Running |
| Elasticsearch | stockSimulator-elasticsearch | 9201 | âœ… Running |

### 4. ëª¨ë‹ˆí„°ë§

| ì„œë¹„ìŠ¤ | ì»¨í…Œì´ë„ˆ | í¬íŠ¸ | ìƒíƒœ |
|--------|---------|------|------|
| Prometheus | stockSimulator-prometheus | 9091 | âœ… Running |
| Grafana | stockSimulator-grafana | 3001 | âœ… Running |

### 5. Backend ë¹Œë“œ ë° Docker ì´ë¯¸ì§€ ìƒì„±

```bash
# Gradle ë¹Œë“œ
cd ~/Stock-Simulator/backend
./gradlew build -x test

# Docker ì´ë¯¸ì§€ ë¹Œë“œ
./infra/scripts/build-docker-images.sh

# ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose --profile services up -d
```

### 6. Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •

```bash
# ì„¤ì • íŒŒì¼ ë³µì‚¬
sudo cp ~/Stock-Simulator/infra/nginx/gijun.net /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/gijun.net /etc/nginx/sites-enabled/

# Nginx ì¬ì‹œì‘
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ

### ì¸í”„ë¼ ì„œë¹„ìŠ¤
```
CONTAINER ID   NAME                          STATUS
xxxxx          stockSimulator-postgres       Up (healthy)
xxxxx          stockSimulator-postgres-replica  Up
xxxxx          stockSimulator-mongo          Up (healthy)
xxxxx          stockSimulator-redis          Up (healthy)
xxxxx          stockSimulator-kafka          Up (healthy)
xxxxx          stockSimulator-kafka-ui       Up
xxxxx          stockSimulator-elasticsearch  Up (healthy)
```

### ëª¨ë‹ˆí„°ë§
```
CONTAINER ID   NAME                          STATUS
xxxxx          stockSimulator-prometheus     Up
xxxxx          stockSimulator-grafana        Up
```

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
```
CONTAINER ID   NAME                              STATUS
xxxxx          stockSimulator-eureka-server      Up (healthy)
xxxxx          stockSimulator-api-gateway        Up (healthy)
xxxxx          stockSimulator-user-service       Up
xxxxx          stockSimulator-stock-service      Up
xxxxx          stockSimulator-trading-service    Up
xxxxx          stockSimulator-event-service      Up
xxxxx          stockSimulator-scheduler-service  Up
xxxxx          stockSimulator-news-service       Up
xxxxx          stockSimulator-season-service     Up
xxxxx          stockSimulator-frontend           Up
```

---

## ğŸ› ï¸ ëª…ë ¹ì–´ ëª¨ìŒ

### Docker Compose ê´€ë¦¬

```bash
# í”„ë¡œí•„ë³„ ì‹œì‘
docker-compose --profile infra up -d        # ì¸í”„ë¼
docker-compose --profile monitoring up -d   # ëª¨ë‹ˆí„°ë§
docker-compose --profile services up -d     # ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
docker-compose --profile frontend up -d     # í”„ë¡ íŠ¸ì—”ë“œ
docker-compose --profile all up -d          # ì „ì²´

# ìƒíƒœ í™•ì¸
docker-compose ps

# ë¡œê·¸ í™•ì¸
docker-compose logs -f <service-name>
docker-compose logs --tail=100 user-service

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart <service-name>

# ì„œë¹„ìŠ¤ ì¬ë¹Œë“œ
docker-compose up -d --build <service-name>

# ì „ì²´ ì¤‘ì§€
docker-compose down

# ë³¼ë¥¨ í¬í•¨ ì‚­ì œ (ì£¼ì˜: ë°ì´í„° ì‚­ì œë¨)
docker-compose down -v
```

### ì»¨í…Œì´ë„ˆ ì ‘ì†

```bash
# PostgreSQL ì ‘ì†
docker exec -it stockSimulator-postgres psql -U stocksim -d stocksimulator

# MongoDB ì ‘ì†
docker exec -it stockSimulator-mongo mongosh -u stocksim -p stocksim123 --authenticationDatabase admin

# Redis ì ‘ì†
docker exec -it stockSimulator-redis redis-cli -a stocksim123

# Kafka í† í”½ í™•ì¸
docker exec -it stockSimulator-kafka kafka-topics --list --bootstrap-server localhost:9092
```

### ì´ë¯¸ì§€ ê´€ë¦¬

```bash
# ì´ë¯¸ì§€ ë¹Œë“œ
./infra/scripts/build-docker-images.sh

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ë¹Œë“œ
docker-compose build user-service

# ì´ë¯¸ì§€ ëª©ë¡
docker images | grep stocksim

# ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì •ë¦¬
docker image prune -a
```

---

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸°ë¡

### 1. ì„œë¹„ìŠ¤ DB ì—°ê²° ì‹¤íŒ¨
**ì¦ìƒ:** `Communications link failure` - DB ì—°ê²° ê±°ë¶€
**í•´ê²°:** 
- ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í™•ì¸: `docker network inspect stock-simulator_stocksim-network`
- í—¬ìŠ¤ì²´í¬ ìƒíƒœ í™•ì¸: `docker-compose ps`
- í™˜ê²½ë³€ìˆ˜ í™•ì¸: `docker inspect <container> | grep -A 20 Env`

### 2. Kafka ì—°ê²° ì‹¤íŒ¨
**ì¦ìƒ:** `Connection refused` - Kafka ì—°ê²° ê±°ë¶€
**í•´ê²°:**
- Zookeeperê°€ ë¨¼ì € ì‹œì‘ë˜ì—ˆëŠ”ì§€ í™•ì¸
- Kafka ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸: `docker-compose logs kafka`

### 3. í¬íŠ¸ ì¶©ëŒ
**ì¦ìƒ:** `port is already allocated`
**í•´ê²°:**
- ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ í™•ì¸: `netstat -ano | findstr :<port>` (Windows)
- ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ í™•ì¸: `sudo lsof -i :<port>` (Linux)
- ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ë˜ëŠ” docker-compose.ymlì—ì„œ í¬íŠ¸ ë³€ê²½

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
infra/
â”œâ”€â”€ docker/               # Dockerfile ëª¨ìŒ
â”‚   â”œâ”€â”€ backend/          # ë°±ì—”ë“œ ì„œë¹„ìŠ¤ Dockerfile
â”‚   â””â”€â”€ frontend/         # í”„ë¡ íŠ¸ì—”ë“œ Dockerfile
â”œâ”€â”€ grafana/
â”‚   â””â”€â”€ provisioning/     # Grafana ìë™ ì„¤ì •
â”‚       â”œâ”€â”€ dashboards/
â”‚       â””â”€â”€ datasources/
â”œâ”€â”€ nginx/                # Nginx ì„¤ì •
â”‚   â”œâ”€â”€ gijun.net         # ë©”ì¸ ë„ë©”ì¸ ì„¤ì •
â”‚   â””â”€â”€ nginx.conf        # Docker ë‚´ë¶€ìš©
â”œâ”€â”€ postgres/
â”‚   â””â”€â”€ init-schemas.sql  # ìŠ¤í‚¤ë§ˆ ì´ˆê¸°í™”
â”œâ”€â”€ prometheus/
â”‚   â””â”€â”€ prometheus.yml    # Prometheus ì„¤ì •
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ build-docker-images.sh # ì´ë¯¸ì§€ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ README.md             # ì¸í”„ë¼ ë¬¸ì„œ
```

---

## ğŸ”— ì ‘ì† URL

| ì„œë¹„ìŠ¤ | URL |
|--------|-----|
| Frontend | https://gijun.net/ |
| API Gateway | https://api.gijun.net/ |
| Eureka Dashboard | http://localhost:8761/ |
| Kafka UI | http://localhost:8089/ |
| Grafana | http://localhost:3001/ (admin/stocksim123) |
| Prometheus | http://localhost:9091/ |
