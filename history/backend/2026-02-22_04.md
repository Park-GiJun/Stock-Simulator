# 2026-02-22_04: NPC/기관 자동매매를 전체 투자자 확률 기반 매매로 변경

## 변경 사항
### 1. 스케줄러 통합 (3개 → 1개)
- NPC: HIGH/MEDIUM/LOW 각각 5분/15분/30분 → 단일 5분 주기
- 기관: HIGH/MEDIUM/LOW 각각 5분/15분/30분 → 단일 10분 주기
- `tradingFrequency`, `maxBatchSize` 파라미터 제거

### 2. 전체 투자자 조회 엔드포인트 추가
- `GET /api/investors/npcs/all` - 전체 NPC 목록 조회
- `GET /api/investors/institutions/all` - 전체 기관투자자 목록 조회
- 새 UseCase, PersistencePort `findAllList()`, Adapter 구현 추가

### 3. 확률 기반 매매 판정 (핵심 변경)
- 기존: frequency별 스케줄러가 해당 frequency NPC만 가져와서 전원 매매 실행
- 변경: 전체 NPC/기관 조회 후 각 투자자의 tradingFrequency 기반 확률 판정
  - HIGH: 60%, MEDIUM: 30%, LOW: 15%
- 확률 통과한 투자자만 `processNpcTrading()` / `processInstitutionTrading()` 실행

### 4. Kafka 이벤트 간소화
- `NpcTradingTriggerEvent`: `tradingFrequency`, `maxBatchSize` 필드 제거
- `InstitutionTradingTriggerEvent`: 동일하게 제거

## 수정 파일 목록
| 파일 | 변경 |
|------|------|
| `backend/common/.../event/DomainEvent.kt` | NpcTradingTriggerEvent, InstitutionTradingTriggerEvent에서 tradingFrequency, maxBatchSize 필드 제거 |
| `backend/scheduler-service/.../port/out/TriggerPublishPort.kt` | publishNpcTradingTrigger(), publishInstitutionTradingTrigger() 파라미터 제거 |
| `backend/scheduler-service/.../event/KafkaTriggerPublisher.kt` | 구현부 파라미터 제거, 이벤트 생성 시 인자 없이 생성 |
| `backend/scheduler-service/.../scheduler/NpcTradingScheduler.kt` | 3개 @Scheduled → 1개 통합 (fixedRate=300_000, 5분) |
| `backend/scheduler-service/.../scheduler/InstitutionTradingScheduler.kt` | 3개 @Scheduled → 1개 통합 (fixedRate=600_000, 10분) |
| `backend/stock-service/.../port/in/npc/GetAllNpcsUseCase.kt` | 새 파일 - 전체 NPC 조회 UseCase |
| `backend/stock-service/.../port/in/institution/GetAllInstitutionsUseCase.kt` | 새 파일 - 전체 기관 조회 UseCase |
| `backend/stock-service/.../port/out/npc/NpcPersistencePort.kt` | findAllList() 추가 |
| `backend/stock-service/.../port/out/institution/InstitutionPersistencePort.kt` | findAllList() 추가 |
| `backend/stock-service/.../persistence/npc/adapter/NpcPersistenceAdapter.kt` | findAllList() 구현 |
| `backend/stock-service/.../persistence/institution/adapter/InstitutionPersistenceAdapter.kt` | findAllList() 구현 |
| `backend/stock-service/.../handler/npc/NpcCommandHandler.kt` | GetAllNpcsUseCase 구현, getAllNpcs() 메서드 추가 |
| `backend/stock-service/.../handler/institution/InstitutionCommandHandler.kt` | GetAllInstitutionsUseCase 구현, getAllInstitutions() 메서드 추가 |
| `backend/stock-service/.../web/InvestorWebAdapter.kt` | GET /api/investors/npcs/all, GET /api/investors/institutions/all 엔드포인트 추가 |
| `backend/event-service/.../client/StockServiceFeignClient.kt` | getAllNpcs(), getAllInstitutions() Feign 메서드 추가 |
| `backend/event-service/.../port/out/trading/InvestorProfileQueryPort.kt` | getAllNpcs(), getAllInstitutions() 포트 메서드 추가 |
| `backend/event-service/.../client/adapter/InvestorProfileQueryAdapter.kt` | getAllNpcs(), getAllInstitutions() 구현 |
| `backend/event-service/.../handler/trading/NpcTradingHandler.kt` | 전체 NPC 조회 + 확률 기반 판정 로직으로 변경 |
| `backend/event-service/.../handler/trading/InstitutionTradingHandler.kt` | 전체 기관 조회 + 확률 기반 판정 로직으로 변경 |
| `backend/event-service/.../event/NpcTradingTriggerConsumer.kt` | handleNpcTrading() 인자 없이 호출 |
| `backend/event-service/.../event/InstitutionTradingTriggerConsumer.kt` | handleInstitutionTrading() 인자 없이 호출 |

## 배포 시 필요 작업
- 4개 서비스 재배포 필요: common(의존성), scheduler-service, stock-service, event-service
- Kafka 토픽 스키마 변경됨 (하위 호환 - 필드 제거만), 기존 메시지 소비 시 무시됨
