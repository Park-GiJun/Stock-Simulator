# 2026-02-23_02: 주문 REJECTED 저장, NPC/기관 사전필터링, 뉴스 content 제거

## 변경 사항

### 1. 검증 실패 시 주문을 REJECTED로 DB 저장
- `OrderCommandHandler.placeOrder()`에서 `validatePreOrder()` 실패 시 예외를 catch
- 주문을 REJECTED 상태로 생성하여 DB에 저장 후 결과 반환
- 기존: 예외 발생 → 주문 미저장 → Kafka consumer에서 로그만 남김
- 변경: 예외 catch → REJECTED 주문 저장 → 주문 내역에서 조회 가능

### 2. NPC/기관 자동매매 사전 필터링
- 잔액 없으면 매수(BUY)를 아예 고려하지 않음
- 보유 종목 없으면 매도(SELL)를 아예 고려하지 않음
- BUY/SELL 모두 불가능하면 LLM 호출 없이 스킵 (토큰 절약)
- `TradingDecisionRequest`에 `allowedActions` 필드 추가
- LLM 프롬프트에 허용 액션만 표시
- LLM 응답 후에도 `allowedActions` 검증 (이중 안전장치)

### 3. 뉴스 발행 시 content 없이 headline만
- LLM 뉴스 프롬프트에서 `content` 필드 제거 (토큰 절약)
- IPO/Delisting 템플릿 뉴스에서도 content를 빈 문자열로 변경
- DB 스키마/이벤트 구조는 유지 (content 필드는 빈 문자열로 저장)

## 수정 파일 목록
| 파일 | 변경 |
|------|------|
| `backend/trading-service/.../handler/order/OrderCommandHandler.kt` | validatePreOrder 실패 시 REJECTED 주문 저장 |
| `backend/event-service/.../port/out/trading/TradingDecisionGeneratePort.kt` | `allowedActions` 필드 추가 |
| `backend/event-service/.../handler/trading/NpcTradingHandler.kt` | 잔액/보유 기반 허용 액션 필터링 |
| `backend/event-service/.../handler/trading/InstitutionTradingHandler.kt` | 잔액/보유 기반 허용 액션 필터링 |
| `backend/event-service/.../generator/TradingDecisionGeneratorWithLLM.kt` | LLM 프롬프트에 허용 액션 반영 |
| `backend/event-service/.../generator/NewsContentGeneratorWithLLM.kt` | content 제거, headline만 생성 |
| `backend/event-service/.../domain/service/NewsContentGenerator.kt` | IPO/Delisting content 빈 문자열 |

## 배포 시 필요 작업
- trading-service, event-service 재빌드 및 재배포
